SELECT DISTINCT  T0.[ItemCode],  T0.[ItemName],  CASE WHEN T0.[ByWh] = 'Y' THEN        T1.[WhsCode] ELSE 'Todos' END as WhsCode, CASE WHEN T0.[ByWh] = 'Y' THEN        T1.[MinStock]  ELSE T0.[MinLevel]  END as MinLevel,   CASE WHEN T0.[ByWh] = 'Y' THEN        T1.[OnHand]  ELSE T0.[OnHand]  END as OnHand,   T0.OnOrder as 'Pedidos Compras Abertos', CASE   WHEN T0.ByWh = 'Y' THEN	 CASE WHEN 		(T1.[MinStock] - T1.[OnHand] - T0.[OnOrder]) < 0	 THEN 0		ELSE (T1.[MinStock] - T1.[OnHand] - T0.[OnOrder])	 END   ELSE	 CASE WHEN 		(T0.[MinLevel] - T0.[OnHand] - T0.[OnOrder]) < 0	 THEN 0		ELSE (T0.[MinLevel] - T0.[OnHand] - T0.[OnOrder])	 END  END as 'Necessidade'FROM OITM T0 INNER JOIN OITW T1 ON T0.ItemCode = T1.ItemCodeINNER JOIN OWHS T2 ON T2.WhsCode = T1.WhsCodeWHERE ( ( T0.[MinLevel] <> 0 AND T0.[OnHand] <= T0.[MinLevel] AND T0.ByWh <> 'Y' ) or   ( T1.[MinStock] <> 0 AND T1.[OnHand] <= T1.[MinStock] AND T0.ByWh = 'Y') ) and T0.PrCrMntMTd = 'B' and T0.ValidFor = 'Y' andT2.DropShip = 'N' andT2.Inactive = 'N' andT1.Locked = 'N' order by T0.ItemCode